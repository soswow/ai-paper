%!TEX TS-program = xelatex
%!TEX encoding = UTF-8 Unicode

\documentclass[12pt]{report}

\usepackage{tocloft}

%\setlength\cftparskip{-2pt}
%\setlength\cftbeforechapskip{0pt}

\usepackage{xecyr}
%\usepackage[utf8x]{inputenc}
\usepackage[russian]{babel}

%\usepackage[utf8x]{inputenc}
%\usepackage[english,russian]{babel}

\usepackage[top=2.5cm, bottom=2.5cm, left=3cm, right=2.5cm]{geometry}                % See geometry.pdf to learn the layout options. There are lots.
\geometry{a4paper}                   % ... or a4paper or a5paper or ... 
%\geometry{landscape}                % Activate for for rotated page geometry
%\usepackage[parfill]{parskip}    % Activate to begin paragraphs with an empty line rather than an indent
\usepackage{graphicx}
%\usepackage{amssymb}

\usepackage{fancyhdr}
\pagestyle{fancy}
\lhead{}
\rhead{\footnotesize{Искусственный интеллект в играх}}
\cfoot{}
\rfoot{\thepage}

\pagenumbering{arabic}

\usepackage{setspace}
\onehalfspacing

\usepackage{fontspec,xltxtra,xunicode}
\defaultfontfeatures{Mapping=tex-text}
\setromanfont[Mapping=tex-text]{Times New Roman}
\setsansfont[Scale=MatchLowercase,Mapping=tex-text]{Gill Sans}
\setmonofont[Scale=MatchLowercase]{Andale Mono}

% Will Robertson's fontspec.sty can be used to simplify font choices.
% To experiment, open /Applications/Font Book to examine the fonts provided on Mac OS X,
% and change "Hoefler Text" to any of these choices.


\setlength{\parindent}{0cm}
\setlength{\parskip}{12pt plus 0.5ex minus 0.2ex}
\renewcommand{\headrulewidth}{0pt}

%\title{Искусственный интеллект в играх на примере игры "Войны планет"}
%\author{Александр Мочёнов}
%\date{26 Октября 2010 г.}                                           
% Activate to display a given date or no date

\usepackage{titlesec}
\titleformat{\chapter}[hang]{\bf\normalsize\uppercase}{\thechapter}{2pc}{}
\titleformat{\section}[hang]{\bf\normalsize}{\thesection}{2pc}{}	
\titleformat{\subsection}[hang]{\bf\normalsize}{\thesubsection}{2pc}{}
\titlespacing{\chapter}{0pt}{*4}{*1}

\usepackage{hyperref} 
%\usepackage{graphicx}
\usepackage{pstricks}
%\DeclareGraphicsExtensions{.png}

%\newcommand{\executeiffilenewer}[3]{%
% \ifnum\pdfstrcmp{\pdffilemoddate{#1}}%
% {\pdffilemoddate{#2}} >0 {\immediate\write18{#3}}\fi%
%}
%
%\newcommand{\includesvg}[1]{%
%\executeiffilenewer{#1.svg}{#1.pdf}%
%{inkscape -z -D --file=#1.svg --export-pdf=#1.pdf --export-latex}%
%\input{#1.tex}%
%}
\usepackage{subfig}

\usepackage{url}

\usepackage{natbib}
\bibpunct{(}{)}{;}{a}{,}{,}

\newenvironment{myItemize}{
	\begin{itemize}
  		\setlength{\itemsep}{1pt}
  		\setlength{\parskip}{0pt}
  		\setlength{\parsep}{0pt}
}{\end{itemize}}

\newenvironment{myEnumerate}{
	\begin{enumerate}
  		\setlength{\itemsep}{1pt}
  		\setlength{\parskip}{0pt}
  		\setlength{\parsep}{0pt}
}{\end{enumerate}}

\usepackage{totcount}
\regtotcounter{figure}
\regtotcounter{table}
\regtotcounter{chapter}

\usepackage[acronym,toc]{glossaries}
\makeglossaries
%\input{glossary}


\renewcommand{\cfttoctitlefont}{\normalsize\textbf}
\setlength{\cftaftertoctitleskip}{20pt}


\usepackage{listings}


\begin{document}
%\renewcommand{\chaptername}{} 
%\renewcommand{\thechapter}{} 
%\renewcommand{\thesection}{\arabic{section}} 

\begin{titlepage}
  \begin{center}
	\uppercase{Высшая школа майнор}\\*
	Институт инфотехнологии\\*
	Веб программирование\\[8cm]
	Александр Мочёнов\\*
	IT-3-Q-V-Tal\\[0.5cm]
	\large
	\textbf{Искусственный интеллект в играх на примере\\* игры ``Войны планет''}\\[1cm]
	\normalsize
	Курсовая работа\\[2cm]
	\begin{flushright}
		Руководитель: Zahhar Kirillov, MSc\\[7cm]
	\end{flushright}
	Таллинн 2010
  \end{center}
\end{titlepage}

\tableofcontents{\thispagestyle{fancyplain}}

\chapter*{Резюме}
\addcontentsline{toc}{chapter}{Резюме}
\thispagestyle{fancy}

Данная работа состоит в целом из: \total{chapter} частей, более чем 6300 слов, \total{table} таблицы и \total{figure} картинок.

Ключевые слова: \emph{искусственный интеллект}, \emph{игра}, \emph{теори игр}, \textsl{google ai challenge}

В данной работе рассматриваются вопросы и проблемы создания игрового Искусственного Интеллекта. Эта область науки является сравнительно молодой областью, и в ней до сих пор много вопросов без ответов, что делает ей актуальной и привлекательной для автора. Сегодня искусственный интеллект есть во всех играх, и их популярность напрямую зависит от качества искусственного интеллекта. Это делает тему искусственного интеллекта в играх востребованной.

\textbf{Целью данной работы является знакомство автора с темой и применение полученных знаний при участии в соревновании ``Google AI Challenge'' и написании собственного искусственного интеллекта в виде бота для игры ``Войны Планет''.}

В дополнение к основной целе работы автор ставит перед собой следующие задачи:
\begin{myItemize}
\item Изучение и применение на практике компьютерной верстки \LaTeX;
\item Переписывание игрового движка, доработка визуализатора игры и прочее при подготовки окружения для разработки;
\item Проверить применимость знание о военном ремесле при разработки стратегии ведения игры;
\item Использование системы версионирования исходного кода \emph{git} при разработки программы; 
\end{myItemize}

В ходе работы автор приходит к выводу, что для его задачи современные способы написания искусственного интеллекта не подходят. Структура полученного искусственного интеллекта представляет собой стратегический план и делиться на 6 частей: первый шаг, самооборона, защита своих войск, атака, перегруппировка и хитрость. Программный код составляет более 1000 строк, написанных на языке Python.

В ходе испытаний автор убедился в жизнеспособности своего алгоритма, что является главным выводом данной работы.

%\printglossary[title=Терминалогия и переводы,style=fancy,toctitle=Терминалогия и переводы]

\chapter*{Введение}
\addcontentsline{toc}{chapter}{Введение}
\thispagestyle{fancy}

С созданием первого программируемого компьютера сразу после окончания Второй Мировой Войны (1940-1950 гг.) возникла область науки изучающая компьютерные программы, обладающие способностью ``мыслить'' в том или ином смысле. Эту науку и технологию назвали \emph{Искусственный интеллект} (ИИ). Её основоположниками являются многие учёные, стоящие за созданием тех же первых компьютеров (Алан Тюринг, Джон Маккарти, Марвин Мински и др.)

История ИИ знала более 5 периодов упадка (т.н. ``Зима в ИИ'') и столько же возрождений, каждый раз меняя вектор в изучения ИИ. По-этому до сих пор эта наука является областью в которой имеется множество вопросов без ответов, а добиться результата может каждый \citep{russell1995}, в отличии от более старых и фундаментальных областей вроде физики и химии. ``Искусственный интеллект, с другой стороны, всё ещё открывает возможности для проявления талантов нескольких настоящих Эйнштэйнов'' \citep{russell1995} Это всё делает ИИ для автора исключительно интересной областью для изучения.

Практически сразу после основания ИИ появились первые программы, играющие в игры. В 1957-ом году Кристофер Стрэчи написал игру, играющую в шашки. Тогда же был написан первый ИИ, примитивно играющий в шахматы. \citep{russell1995} ИИ в компьютерных играх с тех пор значительно развился. Тем не менее, шахматную программу сильнее человека смогли написать лишь в 1997-ом году, когда DeepBlue одержала победу над Гарри Каспаровым. Это стало возможным лишь благодаря увеличению компьютерных мощностей. Но этот успех был возможен также благодаря новым алгоритмам и подходам\footnote{Хотя сами создатели не считали свой творение ``интеллектуальным''\cite{moravec1998will}}. В любом случае не стоит полагать, что развитие компьютерной техники является ``серебряной пулей'' в решении всех проблем в компьютерных ИИ. Например, игра ``Го''\footnote{Го - это стратегическая настольная игра. Го является одной из наиболее распространённых настольных игр на Земле \cite{GoGameWiki}} до сих пор является нерешённой задачей для программистов ИИ. Самая умная на сегодняшний день играет в неё на любительском уровне. \citep{russell1995}

Сегодня индустрия компьютерных игр практически не обходится без применения ИИ. Он в играх, на ряду с графическими и прочими характеристиками, является важным качественным показателем и напрямую влияет на их конкурентно-способность и успех. Это делает игровой ИИ востребованным. Игры по своей природе зачастую имеют не только развивающую, но и развлекательную составляющую, по-этому автору данная тема особенно интересна.

% Про Теорию игр
Целью автора является знакомство с областью науки ИИ, изучение её основ с последующим применением полученных знаний на практике в ходе разработки и написания собственного ИИ, играющего в игру с другими себе подобными. Для практического задания автор участвует в соревновании ``Google AI Challenge'' (\url{http://ai-contest.com/}), в ходе которого разрабатывает ИИ для игры ``Войны планет''. Написание программы, которая играет в игру в качество одно из игроков, обладающему знаниями в программировании автору, представляется не только интересным, но и весёлым занятием. Такую программу принято называть \emph{ботом} (сокращение от слова робот). Методология, применяемая автором, в основном квалитативна и выводы по большей части представляют, основанное на полученных результатах, субъективное мнение автора.

ИИ является чрезвычайно широкой сферой науки, и для написания игрового ИИ можно применять множество кардинально отличных друг от друга подходов и алгоритмов. Для написания ИИ автор использует \emph{символьно-логический}, \emph{агенто-ориентированный} подход без алгоритмов поиска. Автор не делает глубокого анализа принимая это решение, что бы не выйти за рамки допустимых объёмов работы. Тем не менее он объясняет причину своего выбора. Так же в работе применяются понятии из \emph{теории игр}.

``Войны планет'' -- так называется игра для которой автор пишет ИИ. Как следует из названия в каком-то смысле игра о войне. По-этому как дополнение к написанию своего бота, автор ставит задачу проверки применимости знаний о военном ремесле, взятых из древнего трактата Сунь Дзы ``Искусство войны'', к дизайну стратегий и тактик ИИ.

Так же автор ставит задачу изучения системы компьютерной вёрстки \LaTeX, применения её в ходе написания данной работы. Эта система широко применяется в научной среде для написания статей, книг и прочих научных работ, по-этому такие знание должны быть полезны автору в целом и как тренировка перед написанием дипломной работы.

Для эффективного управления версиями исходного кода при написании используется система версионирования git. А для вспомогательных программ (всё за исключением исходного кода самого бота) автор выложил на сайте GitHub\footnote{Сайт на котором можно делать git хранилище и делиться открытым исходным годом с обществом} (\url{http://github.com/soswow/python-ai-challenge}).

Данная работа будет полезна всем, кому интересна тема ИИ. Ознакомившись с данной работой, можно сложить представление о том, что можно сделать и с чего можно начать, если стоит задача в написании игрового ИИ.

\chapter{Введение в предметную область}
\thispagestyle{fancy}
Прежде чем подойти к описанию выбранной игры и непосредственному написанию игрового ИИ для неё, необходимо ознакомиться с некоторыми теоретическими аспектами вопроса.
Так что же такое ИИ? Чёткого ответа на этот вопрос нет. Есть 4 основных вида определений, которые можно обобщить следующим образом: \citep{russell1995} Искусственный интеллект это:
\begin{myItemize}
\item Системы, которые думают подобно людям
\item Системы, которые думают рационально
\item Системы, которые действуют подобно людям
\item Системы, которые действуют рационально
\end{myItemize}
Есть мнение, что искусственный интеллект даёт возможность компьютерам выполнять мыслительные задачи, на которые способны люди и животные.\citep{millington2009} 

``Может ли машина мыслить?'' -- этим вопросом задался Алан Тюринг в 1950 году в статье ``Вычислительная машина и интеллект'' \citep{alan1950}, в которой он предлагает тест на способность машины проявлять интеллектуальность. Суть теста такова: человеку даётся возможность пообщаться с кем-то через текстовую консоль (чат), после чего человека спрашивают - говорил ли он с ИИ или с человеком? Если ИИ заставляет поверить, что он - настоящий человек или даже просто засомневаться, то тест считается пройденным. Этот тест является основой в \emph{философии об искусственном интеллекте}, хотя и подвергался неоднократной критике. \citep{searle1980} На данный момент ни один ИИ не справился с ним на 100 процентов.


\section{Подходы к написанию ИИ}
Как уже было сказано выше ИИ развивается с 50-ых годов ХХ века. За это время сложилось два основных направления в написании ИИ.


\subsection{Символьный и логический подходы}
\emph{Символьный} подход в написании ИИ сформировался в начале 50-ых. Этот подход заключается в разделении ИИ на две части: \emph{база знаний} и набор механизмов, которые этими знаниями манипулируют, что бы получить решение проблемы или новые знания. Такими механизмами часто являются \emph{алгоритмы поиска}.

ИИ такого типа может обладать большой базой знаний и не очень сложными алгоритмами. Таковыми являются, например, \emph{экспертные системы} (ЭС). ЭС - это программы, которые заменяют человека-эксперта в какой-либо области. Их цель - дать заключение (решение) для задачи, исходя из полученных входных данных, используя имеющуюся базу знаний, которая пополняется или вручную или автоматически, если система обладает способностью к самообучению.

%авторство

ИИ можно сделать также с небольшим количеством знаний (или их полным отсутствием) и мощными алгоритмами поиска. Такие алгоритмы не полагаются на уже имеющиеся знания, а пытаются найти решение проблемы обладая только входными данными. Такой подход часто становиться основой для ИИ в настольных играх (шашки, реверси, шахматы).

Возможны и комбинированные решения. Так, например, вышеупомянутая программа DeepBlue умела как очень эффективно искать\footnote{до 30 миллиардов позиций в расчёте на каждый ход, обычно достигая глубины поиска 14}, так и обладала базой знаний эндшпилей, дебютов. А также применяла базу данных из 700 000 игр гроссмейстеров, из которых программа брала согласованные рекомендации. \citep{russell1995}



\subsection{Квазибиологическая парадигма}
До 80-ых годов символьный подход служил опорой для написания ИИ, которые решали не сложные задачи, что с учётом компьютерной техники того времени считалось большим достижением. Когда набор проблем, которые пытались решить с помощью ИИ начал расширяться и усложняться, символьно-логический подход уже не мог справиться с многими из них.

Символьному на смену пришла эпоха моделирования биологических систем, как с применением реальных биологических элементов \citep{rambidi2002}, так и просто копированием систем и процессов из природы. К таким алгоритмам в частности относятся:

\begin{samepage}

\begin{myItemize}
\item Искусственные нейронные сети
\item Генетические алгоритмы
\item Эволюционные вычислени
\end{myItemize}
\end{samepage}
\emph{Искусственные нейронные сети} (ИНС) представляют собой попытку скопировать взаимосвязи и принципы действия биологических \emph{нейронов} (нервных клеток). ИНС представляют собой математическую функцию, где на вход подаётся некий вектор; ИНС пропускает данные через ряд межнейронных связей, преобразуя данные и на выход выдаёт некий выходной вектор, что и является решением задачи.\cite{haykin1994neural}

Генетические алгоритмы и эволюционные вычисления копируют или напоминают эволюционные механизмы в природе. Применяются такие понятия как: мутации, скрещивание, индивидуум, популяции и прочее. В процессе работы алгоритма на разных этапах поиска лучшие решения могут совмещаться, образую новое, улучшенное поколение, а какие-то решения могут случайных образом меняться, т.е. мутировать, внося тем самым положительный стахостический элемент.\citep{russell1995}

Стоит заметить, что нейронные сети, например, были предложены и разработаны ещё в 1943 г. \citep{mcculloch1943} Кто-то считает движение от символьного исчисления к биологическим прогрессом, а кто-то полагает, что это просто дань моде, разной в разные времена. \citep{millington2009} Автор лично придерживается мнения, что какие-то задачи хороши для решения старым, проверенным методом символьной логики. При этом с использованием биологических моделей решение получается не столь эффективным и требует больше усилий, а другие наоборот. Другие же задачи наоборот лучше решать современным методами. Например многие задачи компьютерного зрения хорошо решаются искусственными нейронными сетями. \citep{haykin1994neural}



\subsection{``Хороший'' или развлекательный игровой ИИ}
Все ИИ написанные для игр можно разделить на две категории: ``Хороший'' и развлекательный ИИ.\citep{PlayingToLose} При этом ``хороший'' тут не качественный показатель, а имя собственное. Это зависит от типа игры и от ожиданий игрока.

Основной задачей ``хорошего'' ИИ является победить игрока-соперника, будь-то человек или другой ИИ. Примером такого ИИ может служить программа играющая в шахматы, шашки и другие настольные игры. Люди играют с таким ИИ с целью или попрактиковаться или они просто испытывают напряжение играя с людьми. \citep{PlayingToLose}

Целью же развлекательного ИИ, как следует из названия, является развлечь игрока. Таким ИИ обычно обладает большинство современных игр. В таких играх как ``Sims'' или ``Half-Life'' есть компьютерные игроки, которых называют ``персонажами''. Задача программистов этих игр  сделать персонажей максимально реалистичными и ведущими себя как если бы это был реальный герой. Например, если по персонаж - охранник, то он не должен забывать про игрока, как только он пропадёт из поля зрения игрока, а должен стараться подать сигнал тревоги. Игрок не должен ощущать, что с ним играет компьютер, который пользуется информацией недоступной самому игроку. В противном случае интерес к игре  пропадёт. Что бы обеспечить адекватность и рациональность решений и действий персонажей с ИИ, программисты, например, ограничивают доступ к информации об окружающем мире: ИИ может ``видеть'' только то, что находиться в поле его зрения; ИИ может слышать звуки, что слышат все. Т.е. объём информации доступной ИИ должен быть схож с тем, что может позволить себе игрок. \citep{buckland2005}



\section{Агентно-ориентированный подход}
Агентно-ориентированный подход (АОП) в написании ИИ появился в 1990 г. Он со состоит в разработке \emph{агентов}, которые составляют суть всего АОП. ``Агентом является всё, что может рассматриваться как воспринимающее свою \emph{среду} с помощью \emph{датчиков} и воздействующее на эту среду с помощью \emph{исполнительных механизмов}'' \citep{russell1995} Т.е. ИИ должен иметь доступ к информации о среде в которой он функционирует, на которую он сможет влиять каким-то способом. Схематично это показано на рис \ref{fig:agent}.

\begin{figure}[h]
	\centering
	\input{pic1.tex}
	\caption{Агент взаимодействует со средой с помощью датчиков и исполнительных механизмов \citep{russell1995}}
	\label{fig:agent}
\end{figure}
Такой ИИ представляет собой математическую \emph{функцию агента}, реализовать которую должен программист в виде \emph{программы агента}. Агент может накапливать информацию о полученных состояниях среды, что называется \emph{последовательностью актов восприятия}. Он может использовать их при принятие решения и осуществлении ответных действий. 

Для успешного выполнения поставленной задачи агент должен быть \emph{рациональным}. ``Рациональность - это максимизация ожидаемой производительности, а совершенство - максимизацией фактической производительности'' \citep{russell1995} Рациональный выбор агента зависит только от последовательности актов восприятия, сформированного к данному моменту. Например, если человек переходит дорогу и не посмотрит по сторонам (и попадёт под машину) - это будет нерациональный поступок, т.к. он мог это сделать и повысить ожидаемую производительность. А если он посмотрим по сторонам, и при этом на него упадёт метеорит, то это будет всё равно рациональный поступок.\citep{russell1995} 

Что бы говорить о рациональности, как следует из определения, необходимо определить \emph{критерии производительности}. Для каждого агента этот показатель будет зависеть в основном от среды и от задачи, которую он будет решать. По сути производительность - это на сколько хорошо агент справляется с поставленной задачей. По-этому, что бы написать программу агента надо чётко представлять себе среду в которой он функционирует, механизмы восприятия и воздействия на ней. 

Как будет видно из \ref{chap:practice} части, механизмами восприятия и воздействия в данной игре будет являться программный API. Описание конкретной среды, в которой находиться ИИ и критерии производительности так же будут описаны ниже.


\chapter{Практическая часть}
\label{chap:practice}
\thispagestyle{fancy}
Для того чтобы более конкретно представить себе хотя бы частично как создаётся ИИ и с какими проблемами приходиться сталкивать автор выбирает в качестве практического задания написание ИИ для какой-либо игры. Для этого автор принимает участие в соревновании ``Google AI Challenge'' (\url{http://ai-contest.com/}), организованном компьютерным клубом при Университете Уотерлоу (англ. \emph{``University of Waterloo''}). Компания Google является лишь спонсором проводимого мероприятия. \citep{AIChallangeFAQ} 

Данное соревнование является одним из многих, суть которых заключается в написании ИИ для игры с двумя или более игроками. Участник конкурса должен написать по сути программу агента, которая будет реализовать функцию агента, что часто необходимо сделать в буквальном смысле, реализовав какой-то итерфейс с одной функцией вроде \texttt{``Decition doTurn(gameState)''}. После чего ИИ сражаются друг с другом.

Подобные конкурсы встречаются и у нас в Эстонии. Например, на первом курсе Таллинского Технологического Университета на предмете по программированию в конце курса всем студентам предлагается написать свой ИИ для игры в шашки, после чего все написанные ИИ сражаются друг с другом в турнире.

Подобные соревнования представляются автору наиболее интересным видом практического задания по нескольким причинам. Во-первых это возможность применить знания о программировании и об ИИ. Во-вторых здесь присутствует соревновательский дух, что является несомненно положительным вектором. И на конец речь идёт об играх - а значит это интересно и весело.



\section{Об игре ``Войны планет‘‘}
Игра ``Войны планет'' (далее ВП или просто \emph{игра}) - это пошагавая стратегическая игра для 2-ух и более игроков (рис.~\ref{fig:pw_contest_screenshot}). Она основана компьютерной игре ``Galcon'' \\(\url{http://en.wikipedia.org/wiki/Galcon}, рис. \ref{fig:galcon_screenshot}), специально переработанная для соревнования. В частности, в оригинале игра реального времени, что для упрощения процесса было заменено пошаговым стилем, давая тем самым право хода каждому игроку-боту по очереди.
\begin{figure}[h]
	\centering
	\subfloat[Визуализатор игры на сайте конкурса]{\label{fig:pw_contest_screenshot}\includegraphics[height=0.5\textwidth]{pw_screenshot}}
	\hspace{0.5cm}
	\subfloat[Flash игра ``Galcon'' на офциальном сайте]{\label{fig:galcon_screenshot}\includegraphics[height=0.5\textwidth]{galcon_screenshot}}
	\caption{Фрагменты игр ``Galcon'' \subref{fig:pw_contest_screenshot} и ``Войны планет'' \subref{fig:galcon_screenshot}}
	\label{fig:pw_screenshot}
\end{figure}



\subsection{Сущности игры}
ВП представляют собой 2D холст или карту, где происходит сама игра, на котором действуют следующие сущности (рис. \ref{fig:pw_entities}):
\begin{description}
\item[Планета]\hfill \\
	\emph{Планета} может
	\begin{myItemize}
	\item принадлежать одному из игроков или быть ничейной (нейтральной);
	\item хранить, и если не нейтральная, то и производить корабли с константной скоростью\footnote{\emph{Коэффициент роста} или просто \emph{рост} - это то, сколько кораблей будет появляться на планете за один ход. Обычно варьируется от 0 до 5.};
	\item выпускать корабли для: атаки противника, захвата нейтральных планет или для перегруппировки;
	\item становиться чьей-то в случае нейтральности или менять хозяина в случае успешной атаки;	 
	\end{myItemize}
В начале игры все планеты располагаются на карте и до конца игры не меняют своего положения. \emph{Расстоянием} между планетами считается как округлённое физическое расстояние между координатами планет. Планеты располагаются таким образом, что как бы делят карту на две симметричные половины. Все планеты, кроме двух изначально нейтральные и обладают определённым количеством кораблей. У каждого участника в начале игры есть в наличии по одной планете с сотней кораблей.
\item[Флотилия и корабль]\hfill \\
\emph{Флотилия} - это группа кораблей, которые планета \emph{источник} пустила по направлению к планете \emph{приёмнику}. Флотилия ``живёт'' количество ходов, равное расстоянию между планетами источника и приёмника, перемещаясь за каждый ход на одну единицу\footnote{Имеется ввиду единица расстояния. Например, если расстояние между планетами равняется 5, то флотилия пролетает от одной до другой за 5 ходов.} по направлению к цели. С момента выпуска флотилии с ней ничего нельзя сделать: ни поменять направления, ни отменить решения. \emph{Корабль} - это разменная единица, из которых ``состоят'' флотилии и которые производят планеты участников.
\item[Выбор]\hfill \\
Решение, которое принимает ИИ игрока на каждом \emph{полу-ходу}\footnote{Это половинка всего хода, состоящая из решения одного из игроков} партии (см. \ref{sec:strategic}). Он состоит из набора новых флотилий, выпускаемых на этом ходу игроком.
\end{description}

\begin{figure}[h]
	\centering
	\input{PlanetWarsEntities.tex}
	\caption{Схематичное представление сущностей игры. Легенда слева.}
	\label{fig:pw_entities}
\end{figure}
На рисунке \ref{fig:pw_entities} схематично изображена карта игры со всеми её сущностями. Планеты 2 и 4 принадлежат одному игроку, а 1 и 7 другому. Остальные планеты (3,5,6,8) - нейтральные. Точечной диагональной линией показана воображаемая линия симметрии. Стрелочками обозначены выпущенные или уже летящие флотилии кораблей. В частности игрок играющий светлыми, на этом ходу выпускает флотилию из 26-и кораблей с планеты 7 по направлению планеты 1 (7-1). А флотилия выпущенная ранее вторым игроком со 2-ой планеты на планету 6 перемещается на одну единицу. Таким образом выбором первого игрока является отсылка одной флотилии 7-1, а выбором второго флотилия 2-5. В визуализаторах размер планеты пропорционален зависит от её \emph{росту}.



\subsection{Правила игры}
\label{sec:game_rules}
Игра разделена на ходы. Каждый ход состоит из двух полу-ходов для каждого из игроков. Во время полу-хода игрок делает выбор, отдавая \emph{приказания} о выпуске новых флотилий, указывая планеты отправителя, планету назначения (приёмник) и количество кораблей в каждой флотилии. Планетами отправителя могут быть только свои планеты, а количество кораблей в отправляемой флотилии не должно превышать количество имеющихся на планете. В момент отправки флотилии количество кораблей на планете уменьшается на столько, сколько их во флотилии.

Когда флотилия достигает места назначения она исчезает, изменяя статус для планеты приёмника. Это изменение зависит от сопренадлежности флотилии и планеты приёмника к игрокам. Могут произойти следующие варианты:
\begin{myItemize}
\item Если флотилия прилетела на свою же планету, то корабли флотилии добавляются к кораблям на планете.
\item Если флотилия прилетела на планету противника, то корабли минусуются и на планете остаётся разница. В случае, если кораблей больше во флотилии, то планета меняет хозяина на того чья флотилия это была.
\item Если на планету в один ход прилетает сразу несколько флотилий разных принадлежностей, то работают более сложные правила, которые можно найти на сайте соревнования \citep{PlanetWarsSpec}.
\end{myItemize}
Цель игры - захватить как можно больше планет за максимум 200 ходов. На каждый ход игроку даётся одна секунда. Игра заканчивается или по истечению одного из лимитов, или если у одного из игроков закончатся корабли (как на планетах, так и во флотилиях). \citep{PlanetWarsSpec}



\subsection{Технические данные}
Для участия в соревновании необходимо зарегистрироваться на сайте соревнования. Далее надо скачать начальный пакет, состоящий из игрового движка (написанного на Java), нескольких очень простых ботов, набора из сотни карт и шаблона для написания своего бота. Для разных языков программирования готовых стартовых пакетов имеется четыре варианта для: C++, Java, Python, C\#. Основной движок конкурса поддерживает запуск ботов, написанных также на: Haskell, Ruby, Javascript, PHP, Perl, OCaml и Lisp'е. Стартовые пакеты для них можно найти на форуме соревнования. Автор другим языкам предпочитает Python, по-этому именно на нём он пишет своего бота.

Для того, что бы участвовать в конкурсе в одном из файлов необходимо заполнить логикой метод ``\texttt{def DoTurn(pw): ... }'', где на вход поступает объект в котором имеется API для доступа ко всей информации об игровом состоянии среды. С помощью этого API можно узнать где, какие планеты располагаются, сколько у кого кораблей, от куда куда движутся флотилии, когда прибудут и т.д. 

После реализации бота все необходимые файлы для его запуска надо запаковать в архив и залить на официальный сервер, где бот игрока будет периодически играть с другими ботами, имеющих примерно тот же рейтинг. В зависимости от исхода каждой партии меняется количество очков участника, что сдвигает его в общей рейтинговой таблице.

Во время игры обмен информацией о состоянии игры и выборах игроков в игровом движке происходит следующим образом (рис. \ref{fig:pw_engine_process}):

\begin{figure}[h]
	\centering
	\input{GameProcess.tex}
	\caption{Процесс работы игрового движка}
	\label{fig:pw_engine_process}
\end{figure}
На рисунке \ref{fig:pw_engine_process} вдно, что в начале игры читается файл с описанием начальной карты, которая составляет начальное состояние игры. Это состояние передаётся первому игроку, который делает свой выбор и отдаёт назад приказы об отправлении новых флотилий, после чего всё тоже самое повторяется для второго игрока. Далее движок обрабатывает полученные \emph{выборы}, применяя их к текущему состоянию игры, а так же он делает передвижение уже имеющихся флотилий, происходит прирост кораблей на планетах и обработка прибытий флотилий на планеты. После чего он проверяет терминальное состояние, т.е. не закончена ли игра (см. раздел \ref{sec:game_rules}).

Перед началом игры движок запускает программы игроков в отдельных процессах и устанавливает с ними связь через \emph{стандарт ввода-вывода}, в последствии общаясь по ним с процессами ботов, передовая состояния и зачитывая выборы игроков.



\section{Подготовка к написанию ИИ}
Прежде чем приступить к написанию бота, необходимо решить некоторые дополнительные задачи: подготовить дополнительные средства для помощи в разработки; определиться со средой, в которой функционирует бот для конкретной игры; выбрать методологию написания ИИ и методы принятия решения о выборе;



\subsection{Подготовка окружения для разработки}
В ходе первых попыток написания собственного бота, автор столкнулся с рядом сложностей, в связи с чем составил список того, что необходимо сделать для успешного завершения проекта прежде чем приступать к непосредственному писанию ИИ.
\begin{description}
\item[Журналирование] \hfill \\ Система при которой игровой движок общается с ботами в виде отдельных процессов через стандартный ввод-вывод означает отсутствие возможности \emph{пошаговой отладки} даже во время тестирования на локальном компьютере. По-этому автор с самого начала создал систему \emph{журналирования} (или логов), которая достаточно полно раскрывала процессы, происходящие во время игры.
\item[Свой движок] \hfill \\ Чтение логов утомительный процесс и занимает слишком много времени. Для решения этой проблемы и для более глубокого понимания процессов, происходящих в движке игры автор решил переписать движок на языке Python. Это позволило подключать ИИ напрямую к движку в качестве библиотеки, тем самым довая возможность для отладки.
\item[Модификации в визуализаторе] \hfill \\ Так же для удобства разработки автор модифицировал визуализатор сыгранных игр, написаны на Java и поставляемый в стандартном  наборе (рис. \ref{fig:modif_viz}). 

\begin{figure}[h]
	\centering
	\includegraphics[scale=1]{modified_viz}
	\caption{Фрагмент модифицированного визуализатора}
	\label{fig:modif_viz}
\end{figure}
\pagebreak
В частности: 
	\begin{myItemize}
	\item Была добавлена возможность менять скорость воспроизведения при помощи дополнительного аргумента во время вызова приложения. Изначально она была слишком медленной.
	\item Были добавлены линии, показывающие траекторию полёта флотилий. Часто было не понятно какая цифра куда движется.
	\item Была добавлена возможность передавать визуализатору дополнительную отладочную информацию касательно планет с последующим её выводом на экран (на рисунке белый цыфры под планетами). Например при выборе цели для каждой планеты считается коэффициент, найти и сопоставить с конкретной планетой из логов было достаточно сложно.
	\end{myItemize}
\item[Написание тестов] \hfill \\ В подобной задаче безусловным подспорьем являются \emph{модульные тесты}, которые также присутствуют в написанном ИИ
\item[Система игры на всех картах] \hfill \\
Для эффективной проверки производительности разрабатываемого ИИ был написан несложный \emph{сценарий} для запуска бота на всех картах из начального набора. В конце работы он выдаёт статистическую информацию по тому сколько игр было выигрыно, проиграно и за сколько ходов.
\end{description}



\subsection{Процесс разработки}
Процесс разработки бота можно разделить на несколько этапов:
\begin{myEnumerate}
\item Написание первого бота и тестирование его на всех картах против всех простых ботов, что идут в начальном наборе.
\item Улучшение бота до тех пора, пока он не будет побеждать в $100\%$ случаях.
\item ``Замораживание'' бота в его текущем состоянии и установка его на место противника и переход к пункту 2. Т.е. теперь задача играть против своего же бота, и улучшая следующее поколение прийти к полной победе над ним.
\item Периодически пользоваться TCP Server'ом (\url{http://www.benzedrine.cx/planetwars/}). Это неофициальный централизованный сервер, на котором можно в реальном времени сразиться с другими клиентами сервера. Главное отличие от официально сервера заключается в следующем:
	\begin{myEnumerate} 
	\item В скорости. Подключившись игра начинается практически сразу, в отличии от официального сервера, где каждый бот играет в среднем раз в пол часа.
	\item Не нужно заливать свой программный код на сервер. Код бота запускается на компьютере его владельца, тем самым давая возможность записывать логи для последующего анализа.
	\item Игроки на TCP Server'е зачастую очень сильные, по-этому для бота это всё равно что \emph{стресс тестирование}.
	\end{myEnumerate}
\item Если появляется ощущение, что бот уже достаточно работоспособный, его можно упаковывать и засылать на официальный сервер и переходить к пункту 3.
\end{myEnumerate}



\subsection{Выбор типа ИИ и метода его написания}
На рисунке \ref{fig:agent} (стр. \pageref{fig:agent}) показана модель простейшего агента. Если сравнить её с рисунком \ref{fig:pw_engine_process} (стр. \pageref{fig:pw_engine_process}), то можно заметить, что схема игрока №1 емеет те же составные  части (вход, выход, принятие решения), что и агент. По-этому автор считает уместным в данной задаче применение агентно-ореинтированного подхода. По сути надо реализовать белый ящик со знаком вопроса на рисунке \ref{fig:agent} или более формально функцию агента.

Характеристики игры очень похожи на свойства среды, в которых функционирует агент, играющий в шахматы за одним важным исключением. Средний \emph{коэффициент ветвления} в шахматах примерно равен 35. Т.е. в среднем на каждом полу-ходу игрок может выбирать среди 35 возможных решений, что даёт приблизительно $35^{100}$ различных комбинаций состояний игры. \citep{russell1995} При этом программа DeepBlue могла просмотреть только на 14 ходов вперёд. 

Изучая вопрос эффективности различных методов и подходов для написания ИИ, автор ознакомился с некоторыми мнениями специалистов. Так, Антон Сафонов (MSc, магистерская работа которого была посвящена комбинированию методов оптимизации роя частиц и монте-карло метода) считает, что данная задача должна решаться ``современными способами, т.е. необходимо сделать так, что бы не нужно было говорить программе как решать задачу, а что бы программа сама находила пути её решения''. Т.е. его идея заключалась в применении оптимизированных алгоритмов поиска, абстрагируясь от конкретных планет и флотилий до понятий вроде ``скопление сил'', решая тем самым проблему чрезмерного коэффициента ветвления в ВП. Автору такой подход, ввиду отсутствия необходимых познаний в данной области, показался слишком сложным и непонятным. Более того, ему кажется, что именно ``ручной'' способ написания ИИ в данном случае будет более эффективным.

Для написания агента с использованием конкретных правил и законов, а иначе говоря используя стратегию и тактику, необходимо использовать знания о том ``как работает мир''. Такой агент называется \emph{агентов основанным на модели}. \citep{russell1995} С учётом того, что автор не собирается использовать алгоритмов поиска, для просмотра всех вариантов развития событий, то для такого агента достаточно разработать систему рефлексов, т.е. механизмы реагирующие исключительно на текущее акты восприятия. Хотя некоторые аспекты алгоритма всё же можно рассматривать как предсказание, когда система защиты строится на предположении относительно некоторых планет (см. \ref{sec:selfdefense}).



\subsection{Характер среды}
``Критерии успеха, наряду с описанием среды, а также датчиков и исполнительных механизмов агента, предоставляют полную спецификацию задачи, с которой сталкивается агент'' \citep{russell1995} Критерием успеха или показателем производительности в случае игры ВП является счёт на конец соревнования в итоговой рейтенговой таблице, а так же результат каждой сыгранной партии. Во время локального тестирования на всех картах такими показателями являются также количество ходов, за которое бот победил и проиграл.

Существуют характеристики, по которым можно классифицировать среды в которых оперируют ИИ. \citep{russell1995} В данном случае имеет место форма взаимодействия ИИ-ов, представляющая собой детерминированную, поочередную, охватывающие двух игроков игру с \emph{нулевой суммой} и с \emph{полной информацией}. \citep{russell1995, morgenstern1947} Эти и другие свойства среды и их значения, применительно к данной игре приведены в таблице \ref{tab:evn_properties} (стр. \pageref{tab:evn_properties}).

\begin{table}[h!]
	\centering
	\begin{tabular}{ | p{3.6cm} | p{3cm} | p{7.2cm} |}	
	\hline
	Свойство среды & \raggedright Значение для среды & Почему? \\ \hline \hline
	\raggedright Наблюдаемая полностью или частично & \raggedright Полностью наблюдаемая & ИИ имеет доступ ко всем данным, необходимых для принятия решения. \\ \hline
	\raggedright Детерминированная, стохастическая или стратегическая & \raggedright Стратегическая &  Является таковой, если ``среда является детерминированной во всех отношениях, кроме действий других агентов''\citep{russell1995} \\ \hline
	\raggedright Эпизодическая или последовательная & \raggedright После\-до\-ва\-тель\-ная & Т.к. выбор игрока на каждом ходу влияет на все будущие решения \\ \hline
	\raggedright Статическая или динамическая & \raggedright Полуди\-на\-ми\-чес\-кая & Т.к. ``с течением времени сама среда не изменяется, а изменяются показатели производительности''. \citep{russell1995} Выбор принимается в условиях ограниченного времени. \\ \hline
	\raggedright Дискретная или непрерывная & \raggedright Дискретная & Т.к. игра ``имеет конечное количество различимых состояний'' и она ``связана с дискретным множеством восприятий и действий`` \citep{russell1995} \\ \hline
	\raggedright Одноагентная или мультиагентная & \raggedright Конкурентная мультиагентная среда & Т.к. имеет место соперничающая сущность Б, которая пытается максимизировать показатели своей производимости за счёт минимизации показателей сущности А \\ \hline
	\end{tabular}
	\caption{Характеристики среды игры ВП}
	\label{tab:evn_properties}
\end{table}



\section{Стратегия и тактика}
\label{sec:strategic}
В этом разделе описаны стратегии и тактики, которые автор применил и реализовал в своём агенте. Так же тут делается попытка связать их со знаниями о военном ремесле, описанными в трактате ``Искусство Войны'' (5-6 вв. до н. э.).

\begin{quote}
``Если используешь их[войска] в битве, но победа долго не приходит, их оружие притупляется, а рвение - ослабевает. Если осаждаешь города, их силы истощаются. Если подвергаешь войско длительной войне, запасов государства не хватит ... Поэтому я слышал об успехе быстрых военных походов, и не слышал об успехе затяжных.'' \citep{tzu1971art}
\end{quote}
Это правило действительно и тут, потому что игра продолжается максимум 200 ходов. Что бы достичь победы, медлить нельзя. В этой игре быстрота развёртывания сил и захвата планет очень важен. В момент главного сражения разница в одну планету может решить исход исход партии.

Как уже говорилось ранее в начале игры у обоих игроков условия совершенно идентичные. У каждого есть по планете с сотней кораблей, а все остальные планеты находятся на равных расстояниях от начальных планет игроков, т.к. карта симметричная. Из этого можно ещё раз подчеркнуть мысль, что исход каждого поединка зависит исключительно от алгоритмов игроков.

Общую стратегию, можно охарактеризовать как ``играть, что бы не проиграть'', т.к. по мнению автора главное в этой игре - правильная оборона, что будет раскрыто ниже (см. \ref{sec:selfdefense}).

Вся стратегия автора делиться на 6 этапов или элементов. Алгоритм проходит через все эти этапы принимает решение о выборе. Каждый из них описан далее более подробно.

\subsection{Первый ход и расширение}
Самым первым этапом игры является фаза ``развёртывания'', в которой особенно важно самый первый \emph{выбор}. Причина тому в симметричности первоначального состояния игры для обоих игроков. По-этому очень важно с первых секунд игры попытаться получить преимущество, выбрав планеты для первой атаки наиболее эффективно. 
\begin{quote}
``Тому, кто первым приходит на поле сражения и ожидает врага, будет
легко; тот, кто приходит после и должен спешить в бой, будет утомлен''  \\
\hfill \citep{tzu1971art}
\end{quote}

В отличая от шахмат в этой игре нету игрока идущего первым, оба игрока делаю свой первый плоху-ход не зная о решении противника. Неправильное решение на первом шаге может закончиться быстрой победой противника. Пример на рисунке \ref{fig:first_move1}.

\begin{figure}[h]
	\centering
	\input{first_move_sit.tex}
	\caption{Ошибка первого игрока (светло-серый) на первом шаге}
	\label{fig:first_move1}
\end{figure}
В показанной ситуации начальные планеты игроков находятся очень близко друг от друга и один из участников не обращая на это внимание рассылает б\'{о}льшую часть своих кораблей на захват нейтральных. В то же время его противник не спешит распускать все корабли. В результате ошибки второй игрок следующим ходом захватит изначальную планету первого игрока и получи тем самым победное преимущество, т.к. начальные планеты имеют высокий коэффициент роста (обычно 5).

На самом деле при хорошей самообороне и правильно выбранной \emph{функции выбора цели} для атаки (см. \ref{sec:atack}) никакой особой логики в первый ход вкладывать не обязательно (будет видно далее). Хотя автор всё же разработал рефлекс\footnote{и назвал его ``блицкриг'', хотя название ``вобанк'' тут тоже подходит} который срабатывает на первом и последующих ходах, если ситуация такая как описана выше. Он оставляет все корабли на первом ходу, а на втором посылает все корабли на главную планету противника.

\subsection{Самооборона}
\label{sec:selfdefense}
Самооборону можно считать пожалуй самым важным этапом всей стратегии. От того как хорошо и безошибочно реализован этот модуль алгоритма зависит результативность всего бота. Побеждает тот, у кото суммарный прирост кораблей на всех планетах больше. По-этому потеря любой своей планеты ведёт к изменению этого отношения, а значит этого нельзя допустить ни в кое случае.
\begin{quote}
``Поэтому тот, кто преуспел в войне, первым делом выбирает позицию, где он не может быть разбит, вместе с тем не упуская [любой возможности] разбить врага.'' \\
\citep{tzu1971art}
\end{quote}

Суть самообороны в том, что бы на планете всегда оставалось достаточно кораблей, что бы смочь отбить любую атаку. Для этого прежде всего надо посмотреть сколько и какие флотилии летят на данный момент на планету и представив, что более никакая планета не выпустит флотилий по данному направлению, просимулировать все прилёты кораблей получив в результате чёткое представление о судьбе этой планеты. 

Для удобства была написана специальная функция, которая занимается симуляцией таких случаев. В результате она выдаёт информацию о том на каких ходах и как будет меняться состояние этой планеты (количество кораблей, принадлежность) по мере прилёта флотилий. Из этой информации можно сделать определённый и важный вывод - сколько кораблей необходимо забронировать на самооборону, что бы когда прилетит последняя флотилия планета осталась у игрока.

На рисунке \ref{fig:simulation} упрощенно объясняется как работает алгоритм симуляции. 

\begin{figure}[h]
	\centering
	\input{Simulation.tex}
	\caption{График работы симуляции прибывающих кораблей.}
	\label{fig:simulation}
\end{figure}

На верхней шкале показано будущее планеты с изначально 25-ью кораблями и подлетающими 4 флотилиями (чёрточка на отрезке), 3 из которых чужие (со знаком минус) и одна своя (со знаком плюс). На нижней шкале между чёрточками показано сколько планета успевает набрать (со знаком плюс) между прилётами кораблей; верхние цифры показывают сколько кораблей было к момент прилёта флотилии; снизу показано сколько кораблей осталось после вычитания (или сложение) с прилетевшей флотилией.

Прирост у планеты составляет 5 кораблей, следовательно к прилёту первой флотилии на планете уже будет 40 кораблей.  Корабли противника вычитаются и на планете остаётся 10 кораблей (под шкалой) и так далее.

Для принятия решения о том сколько кораблей необходимо забронировать для защиты надо найти минимальное количество кораблей, какое будет в будущем у планеты. В данному случае это число 3. Следовательно, что бы к этому моменту планета осталась наша (пусть даже без кораблей) сейчас на ней должно остаться $25 - 3 = 22$ корабля, а остальными уже можно пользоваться.
\begin{quote}
``Стратегия ведения войны такова: не полагайся на то, что враг не прийдет, полагайся на средства, которыми располагаешь, чтобы принять его. Не полагайся на то, что враг не нападет; полагайся на то, чтобы наши позиции были неуязвимы для нападения. \\
\ldots\\
С теми, кто рядом, ожидай далекого; с отдохнувшими ожидай
усталого; с сытыми ожидай голодного. В этом путь управления силой.'' \\ \citep{tzu1971art}
\end{quote}
Что бы максимально обезопасить себя от захвата планеты можно посмотреть на ближайшие планеты противника и предположить, что они на следующем ходу выпустят всё что у них есть по направлению к данной планете. Потенциальной угрозой можно считать все планеты противника, что находятся ближе чем первая ближайшая своя планеты. Это показано на рисунке \ref{fig:closetsEnemies}.

\begin{figure}[h]
	\centering
	\input{ClosestEnemyplanets.tex}
	\caption{Учёт потенциальной угрозы со стороны ближайших планет противника.	 }
	\label{fig:closetsEnemies}
\end{figure}

На рисунке видно, что потенциальной угрозой можно считать две нижних планеты, верхняя же планета противника (тёмная) не является угрозой, т.к. на подмогу центральной успеет прийти своя же планета (сверху светло-серая).

Бронирование кораблей необходимо делать в отдельном цикле так, что бы все другие этапы уже имели информацию о том, на сколько кораблей они могут рассчитывать.

Теперь должно быть понятно, почему использование особой логике на первом шагу не обязательно. В случае первого шага данный алгоритм самозащиты увидит стоящую рядом планету противника и рассчитает сколько ему можно пустить на расширение так, что бы в случае если все 100 кораблей полетят на него, он бы смог отбиться. 

\subsection{Защита своих войск}
\begin{quote}
``Непобедимость заключена в самом себе; возможность победы зависит от врага.\\
\ldots\\
Поэтому сказано, что стратегию победы над врагом можно познать, но не всегда можно применить.''\\
\citep{tzu1971art}
\end{quote}

Написать идеальные алгоритм бронирования кораблей для самозащиты невозможно. Всегда будет вероятность при которой, симулируя исход для планеты, окажется, что планета всё таки переходит к противнику. В случае, когда из симмуляции следует, что в обозримом будущем планета перейдёт к противнику, то в таком случае необходимо взять все свои ближайшие планеты и отсортировав их по мере удаления от неё. После отправить с каждой по мере возможности столько кораблей, сколько нужно, что бы в конце планеты осталась у прежнего игрока.

%\begin{quote}
%``Поэтому тот, кто умело ведет войну, подобен змее-шуайчжань. Шуайчжань живет на горе Чаншань. Если ударить ее по голове, отзовется хвост; если ударить по хвосту, отзовется голова. Если ударить по середине, отзовется и хвост, и голова.''\citep{tzu1971art}
%\end{quote}

\subsection{Атака}
\label{sec:atack}
Когда все необходимые корабли забронированы для самообороны, и все флоты высланы на подмогу своим планетам, тогда все оставшиеся свободные корабли можно использовать для атаки. Краеугольным камнем атаки является правильный выбор цели. Для этого необходимо написать оценочную функцию, которая будет оценивать полезность атаки не своих планет для каждой своей планеты. Таким образом у каждой своей планеты образуется список планет отсортированный по этому коэффициенту, из которых каждая по одной рассматривается в качестве цели. В случае, если количество кораблей, которое будет на планете цели к моменту прилёта флотилии будет меньшим, чем есть на данной (для которой ищется цель), то можно отправить флотилию для её захвата. 

Например: Планета противника находиться на расстоянии 3 шагов с 10-ью кораблями и приростом в 2 планеты. Таким образом для того, что бы её захватить необходимо выслать $10 + (3 * 2) + 1 = 17$ кораблей. Если на планете игрока нет такого количества, то в качестве цели рассматривается следующая не своя планета.

Важно понимать, что отправлять флотилию для атаки можно только будучи уверенном в её захвате, иначе игрок просто потеряет корабли, ничего не получив в замен. 

Оценочную функцию можно занять из экономики, на основе которой появилась наука ``Теория Игр''. Все не свои планеты можно представить в виде фондов или недвижимости, вобщем всего того, что приносит деньги и является целью для инвестиций. Корабли при этом представляют собой деньги. В момент отсылки кораблей деньги тратятся. Находясь в полёте денег уже нет. Долетев до цели планета меняет владельца - происходит инвестирование средств. Через какое-то время (зависит от роста планеты) на планете возникнет сумма, которую мы изначально потратили. Это называется \emph{окупаемостью инвестиций}. В случае игры она измеряется в ходах (т.е. за сколько ходов этот вклад самоокупиться) (см. формулу \ref{eq:roi}, стр. \pageref{eq:roi}).
\pagebreak
\begin{equation}
\label{eq:roi}
\centering
k_{pq} = d_{pq} + (\frac{S_q}{G_q})
\end{equation}
\begin{tabular}{p{3cm} c l}
где & $k_{pq}$ & -- коэффициент для планеты-цели $q$ относительно планеты $p$ \\
	& $d_{pq}$ & -- расстояние в ходах между планетами $p$ и $q$ \\
	& $S_q$ & -- количество кораблей на планете $q$ \\
	& $G_q$ & -- скорость прироста на планете $q$ \\
\end{tabular}

Таким образом не всегда самые близкие и самые слабые планеты становятся более желаемой целью, как показано на рисунке \ref{fig:targetingFunction}.
\begin{figure}[h]
	\centering
	\input{TargetingFunction.tex}
	\caption{Планета с коэффициентом = 15 является более приоритетной целью. (Здесь Gr - это скорость роста (англ. Growth Rate)}
	\label{fig:targetingFunction}
\end{figure}

Эту функцию оценки нельзя использовать в чистом виде, т.к. могут возникнуть ситуации, когда планета с самым низким коэффициентом находится ближе к противнику чем к вам. В таком случае такая атака может провалиться. Причиной тому хитрость под названием ``перехват'', которая будет рассмотрена ниже (см. \ref{sec:hints}). А пока можно просто ввести как правило, что атаковать планеты, которые ближе к противнику чем к игроку - нельзя. Особенно это касается первых ходов, когда планеты с хорошим коэффициентом находятся как на одной так и на другой ``сторонах поля''. Так же нежелательны любые длинные перелёты кораблей, т.к. это ведёт к потери контроля над ситуацией, и за время полёта флотилии противник успеет сгруппироваться и защититься. Для этого в оценочную функцию можно внести зависимость от расстояние. Например, умножение расстояние на некий коэффициент больше нуля, таким образом заставляя увеличивать результат функции по мере увеличения расстояния.

\subsection{Перегруппировка}
Как и инвесторы не любят, когда их деньги лежат и ``не работают'', так и игрок должен заботиться о том, что бы все генерируемые корабли приносили свой вклад в победу. В частности может возникнуть ситуация, когда рядом с данной планетой нету ни одной нейтральной или планеты противника. В таком случае все свободные корабли должны быть переправлены ближе к ``линии фронта'', которая часто образуется в игре между достаточно развитыми ботами.

\begin{quote}
``Если мы можем идти вперед и противник тоже может продвигаться, это называется ``доступной местностью''. На такой местности, первым делом занимай высоты и [строну] ян, а также обеспечь пути для подвоза провианта. Тогда, если мы вступим в битву, за нами будет преимущество.''\citep{tzu1971art}
\end{quote}

Что бы перегруппировать корабли необходимо найти цель, которую надо атаковать, после чего найти ближайшую к нему свою планету. Эта планета называется \emph{атакующей}. Зная атакующую планету необходимо найти к ней наиболее подходящий путь. Для этого можно представить все планеты в виде \emph{полносвязного графа}, где \emph{вершинами} являются планеты, а все возможные пути между ними \emph{рёбрами}. Тогда можно воспользоваться одним из имеющихся алгоритмов поиска кратчайшего пути между вершинами. \\ \citep{cormen2001}

Но для упрощения задачи можно найти такой путь более простым способом. Он схематично изображён на рисунке \ref{fig:regrouping}.

\begin{figure}[h]
	\centering
	\input{Regrouping.tex}
	\caption{Выбор потенциального звена при перегруппировки сил по направлению к атакующему}
	\label{fig:regrouping}
\end{figure}

Алгоритм заключается в следующем. Берутся все планеты игрока и сортируются по расстоянию до атакующего. По одному проверяется угол между планетой, кандидатом и атакующем. Если угол больше или равен $120^o$, значит это и есть искомое звено, куда надо отправить свободные корабли. Данный угол был получен опытным путём. Объяснить такой выбор можно тем, что это достаточно тупой угол, и при нём не создаётся слишком длинных маршрутов. Таким образом каждая планета отвечает только за правильную доставку до следующего звена.

\subsection{Хитрость и тактические приёмы}
\label{sec:hints}
\begin{quote}
``Война - это путь обмана. Поэтому, даже если [ты] способен, показывай противнику свою неспособность. Когда должен ввести в бой свои силы, притворись бездеятельным. Когда [цель] близко, показывай, будто она далеко; когда же она действительно далеко, создавай впечатление, что она близко.'' \\ 
\citep{tzu1971art}
\end{quote}

В игре ВП возможно применять так же и некоторые хитрости и тактические приёмы.

Одна такая хитрость называется ``перехват''. Суть её в том, что бы перехватывать только что захваченные врагом планеты. Т.к. чаще всего игроки захватывают планеты с минимальным количеством кораблей во флотилии, то на планетах, сразу после захвата практически нет кораблей. Если такой случай вовремя предвидеть, и вовремя послать свои корабли, прилетающие туда же на один ход позже, то можно небольшой жертвой захватить новую планету.

Другая хитрость касается эффективной защиты от нападения. Если противник высылает флотилию достаточную для захвата планеты игрока, то в таком случае если игрок тут же вышлет подмогу, это сразу может увидеть противник и дослать ещё кораблей. Такая череда дополнительных флотилий со стороны подмоги и досылки для атаки будет постоянной. Тут можно сделать следующее - необходимо дождаться такого момента высылки подмоги, когда она придёт точно в тот же момент, что и атакующая флотилия. Таким образом можно выиграть время, т.к. противник увидит, что кораблей для захвата не хватает только в самый последний момент.

Самооборону противника можно ослепить, если выслать атакующий флот не на прямую на планету противника, а на соседнюю от неё нейтральную, а по прибытию на неё тут же выслать все корабли на противника. Простые алгоритмы проверяют лишь непосредственную угрозу, а в такой ситуации она будет незамеченной и противник не успеет подготовиться достаточно кораблей для обороны.

Важно отметить, что от каждой придуманной тактики и хитрости должна быть продумана и реализована эффективная защита.
\pagebreak
\section{Внутреннее строение бота}
Внутренняя структура программы бота дублирует стратегический план, описанный выше, разбивая процесс принятия решения на отдельные блоки, что показано на рисунке \ref{fig:bot_arch}.

\begin{figure}[h]
	\centering
	\input{bot_arch.tex}
	\caption{Упрощённая архитектура классов наследования бота}
	\label{fig:bot_arch}
\end{figure}

На рисунке видно, что класс с самим ботом \texttt{MyBot} унаследуется от класса \texttt{Bot}, который является подобием интерфейса (в Python нету понятия интерфейса как такового). \texttt{Bot} нследуется напрямую от класса \texttt{PlanetWars}, хранящего состояние игры и все необходимые API для работы с ним: методы восприятие среды и воздействие на неё. В частности, в \texttt{PlanetWars} хранится список планет и список флотилий. Сам \texttt{PlanetWars} наследуется от класса \texttt{Debbugable}, который отвечает за обеспечение условного журналирования и вывода на экран отладочных данных. 
Пример исходного кода приведён в листинге \ref{lis:sim_arrivals}.

\lstset{caption=Метод симулирующий прибытия флотилий,label=lis:sim_arrivals,basicstyle=\footnotesize\ttfamily,captionpos=b,breaklines=true,breakatwhitespace=false,numbers=left,numbersep=5pt,language=Python,frame=single}
\lstinputlisting{sim_arrivals.py}

В листинке приведёт метод, который на вход принимает список объектов, имеющих время прибытие, количество кораблей и принадлежность. В этом списке могут быть как флотилии так и планеты противника представляющие потенциальную угрозу. На строке 10 эти объекты итерируются, где каждый проходит ряд изменений и вычислений, идентичных тем, что производит игровой движок, когда во время применения решений игроков (рис. , стр. ) считает итоге прилётов флотилий на планеты. А именно: строки 12-14 икрементирует рост планеты, 16-21 разбивает по группам всех участников локального боя (какой игрок сколько кораблей привносит), 23-31 рассчитывают победителя и проигравшего (тот кому достанется планета), 33-37 вычитает корабли и меняет владельца планеты, 38 добавляет результат от прилёта флотилии(ий) в результативный список.

На данный момент реализованы все основные механизмы игры, за исключением хитростей и тактичесих манёвров. Автор планирует закончить до окончания соревнования.

\chapter*{Заключение и выводы}
\addcontentsline{toc}{chapter}{Заключение и выводы}
\thispagestyle{fancy}
Результатом исследования автора стали более глубокие и широкие познания в области искусственного интеллекта. Прочитанные книги, статьи, просмотренные выступления специалистов на тему искусственного интеллекта были не бесполезны лично автору. Он познакомился с этой областью науки, что являлось одной из целей этой работы.

Полученные знания помогли автору в написании практического задания и участие в конкурсе ``Google AI Challenge''. Изученный материал позволил более чётко представить себе все возможные направления при написании ИИ. Были рассмотрены основные направления при написании ИИ и классификация сред, в которых функционируют ИИ. По предложенной классификации были рассмотрены характеристики конкретной игры. Были сделаны предположения о неэффективности в данном случае более современных методов создания ИИ.

Всё это помогло автору выбрать направление, наиболее простое, но тем не менее по мнение автора эффективное. Так это или не так покажет время, но на данный момент возможности ИИ автора не предвещают полной неудачи на конкурсе, что говорит о жизнеспособности выбранного пути написания ИИ. Профиль автора и все сыгранные его ботом игры можно найти по адресу \url{http://ai-contest.com/profile.php?user\_id=3984}

На момент написания работы автор всё ещё занимается разработкой ИИ, т.к. соревнование заканчивается в декабре 2010 года. На данный момент более 1000 строк кода написано и потрачено более 100 человеко-часов. По условиях конкурса и исходя из здравого смысла выкладывать код самого ИИ нельзя, по-этому его нет на сайте github. Тем не менее полный исходный код бота можно найти по адресу \url{http://soswow.pri.ee/ai/mybot.zip}.

Все дополнительные задания по написанию собственного игрового движка, доработке стандартного визуализатора, созданию процесса инкрементальной разработки ИИ были выполнены и безусловно помогли автору в написании и улучшении бота. Переписанный автором движок на языке Python код можно найти на сайте git-hub по адресу \url{http://github.com/soswow/python-ai-challenge}.

При изучении древнего трактата о военном ремесле Сунь Дзыня ``Искусство войны'' автор обнаружил несколько подходящих под описание стратегии игры мыслей. Пусть игра называется ``Войны планет'', всё же нельзя говорить, что описанные советы и законы могут один в один лечь в основу стратегии ИИ. Впрочем это и ожидаемо, игра слишком проста, что бы в ней можно было применить всю глубину мудрости описанного в трактате.

Написание работы на \LaTeX стало не таким простым занятием. Основная проблема, с которой пришлось столкнуться автору - это обеспечение всех официальных и необходимых требований к оформлению работы. С большей частью удалось справиться, но некоторые недочёты останутся по всей видимости до следующей работы. Исходный код данной курсовой работы  можно найти по адресу \url{http://soswow.pri.ee/ai/kursovaja.zip}.

\clearpage
\addcontentsline{toc}{chapter}{Литература}

\bibliographystyle{plainnat}
\bibliography{biblio}

\end{document}  